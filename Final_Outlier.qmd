---
title: "The Importance of Outlier Detection With Applications in R"
author: "Rajesh Mahato"
format:
  revealjs:
    theme: simple
    transition: slide
    slide-number: true
    code-fold: false
    code-line-numbers: false
    margin: 0.1
    fontsize: 28px
  beamer:
    theme: default
---

```{=html}
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
.reveal pre {
  font-size: 0.55em;
}
.reveal code {
  font-size: 0.85em;
}
.reveal h2 {
  font-size: 1.5em;
  margin-bottom: 30px;
}
.reveal p, .reveal ul, .reveal ol {
  font-size: 0.85em;
}
</style>
```

## About the Analysis

::::: columns
::: {.column width="50%"}
**Packages Used:**

-   `dplyr` - Data manipulation
-   `ggplot2` - Data visualization
-   `stats` - Statistical functions
:::

::: {.column width="50%"}
**Air Quality Dataset:**

-   153 observations
-   6 variables
-   Target: `Ozone Levels` +
-   Context: Daily air quality in New York (May-Sept 1973)
:::
:::::

------------------------------------------------------------------------

## What Are Outliers?

**Definition**: Data points that differ significantly from other observations in a dataset.

**Types of Outliers:**

1. **Point Outliers** - Single extreme values
2. **Contextual Outliers** - Unusual in specific contexts
3. **Collective Outliers** - Groups of unusual points

**Causes:**

- Measurement errors
- Data entry mistakes
- Natural variation
- Fraudulent activities
- Equipment malfunction

------------------------------------------------------------------------

## Why Outlier Detection Matters

**Environmental Impact:**

- **Public Health**: Trigger emergency alerts when Ozone exceeds 70 ppb safety limits
- **Regulatory:** Flag days violating Clean Air Act standards for compliance action
- **Urban Management:** Guide traffic controls and industrial activity during high pollution
- **Climate Research:** Identify extreme weather patterns and environmental shifts
- **Infrastructure:** Optimize air quality monitoring network placement and maintenance


**Business Impact:**

- **Financial**: Detect fraudulent transactions ($3.75 billion lost to fraud in 2023)
- **Quality Control**: Identify defective products early
- **Marketing**: Find unusual customer behavior patterns
- **Risk Management**: Spot anomalies before they become problems
- **Operations**: Optimize processes by removing noise

**Statistical Impact:**

- Outliers can distort mean and standard deviation
- Affect regression coefficients
- Violate model assumptions
- Reduce predictive accuracy

------------------------------------------------------------------------

## Key Detection Methods

**1. IQR Method (Box Plot Rule)**

- Uses Interquartile Range (Q3 - Q1)
- Outliers: < Q1 - 1.5×IQR or > Q3 + 1.5×IQR
- Robust to extreme values

**2. Z-Score Method**

- Measures standard deviations from mean
- Typically |Z-score| > 3 indicates outlier
- Assumes normal distribution

**3. Local Outlier Factor (LOF)**

- Density-based method
- Compares local density to neighbors
- Good for multivariate data

------------------------------------------------------------------------


## Key Concepts

**Outliers**: Data points that differ significantly from other observations. They can indicate measurement errors, rare events, or interesting phenomena that require special attention.

**IQR Method**: Uses the Interquartile Range (Q3 - Q1) to identify outliers. Points outside Q1 - 1.5×IQR or Q3 + 1.5×IQR are considered outliers. This method is robust to extreme values.

**Z-score Method**:  Measures how many standard deviations a point is from the mean. Typically, |Z-score| > 3 indicates an outlier. Useful for normally distributed data.

**Boxplots**: Visual tool that displays data distribution through quartiles and automatically shows outliers as individual points beyond the whiskers

**Multivariate Outliers**: Observations that are unusual when considering multiple variables simultaneously, not just individually. These can reveal complex patterns.


------------------------------------------------------------------------

## Step 1: Install & Load Packages

```{r}
#| echo: true
#| output: false

# Load required packages
library(dplyr)
library(ggplot2)

# Load and prepare air quality data
data("airquality")
air_clean <- airquality[complete.cases(airquality), ]

cat("Air Quality Dataset Loaded Successfully\n")
cat("Clean dataset dimensions:", dim(air_clean), "\n")
cat("Variables:", names(air_clean), "\n")
```
```
```

**Purpose:** Load the dataset and prepare it for analysis by removing missing values
------------------------------------------------------------------------

## Step 2: Load & Prepare Data

```{r}
#| echo: true
#| output: true

# Basic statistics and data overview
cat("--- Air Quality Dataset Summary ---\n")
summary(air_clean[, c("Ozone", "Solar.R", "Wind", "Temp")])

cat("\n--- Environmental Context ---\n")
cat("Ozone Health Guidelines:\n")
cat("- Good: < 50 ppb\n")
cat("- Moderate Risk: 50-70 ppb\n") 
cat("- High Risk: 70-100 ppb\n")
cat("- Very High Risk: > 100 ppb\n")
```

**What we did:** Examined the air quality dataset structure and established environmental context

------------------------------------------------------------------------

## Step 3: Create Outlier Detection Function 

```{r}
#| echo: true

# Create comprehensive outlier detection function
detect_outliers_iqr <- function(data, column_name) {
  values <- data[[column_name]]
  
  Q1 <- quantile(values, 0.25, na.rm = TRUE)
  Q3 <- quantile(values, 0.75, na.rm = TRUE)
  IQR_value <- Q3 - Q1
  lower_bound <- Q1 - 1.5 * IQR_value
  upper_bound <- Q3 + 1.5 * IQR_value
  
  outliers <- which(values < lower_bound | values > upper_bound)
  
  return(list(
    outliers = outliers,
    bounds = c(lower_bound, upper_bound),
    values = values[outliers],
    indices = outliers,
    count = length(outliers)
  ))
}

cat("Robust outlier detection function created successfully\n")
```

------------------------------------------------------------------------

## Step 4: Detect Ozone Outliers

```{r}
#| echo: true

# Detect outliers in Ozone (primary air quality indicator)
ozone_outliers <- detect_outliers_iqr(air_clean, "Ozone")

cat("--- Ozone Outlier Analysis ---\n")
cat("IQR Bounds:", round(ozone_outliers$bounds, 2), "ppb\n")
cat("Number of high ozone days:", ozone_outliers$count, "\n")
cat("Outlier ozone levels:", sort(round(ozone_outliers$values, 2)), "ppb\n")

# Health risk assessment
high_risk_days <- sum(ozone_outliers$values > 100)
moderate_risk_days <- sum(ozone_outliers$values > 70 & ozone_outliers$values <= 100)

cat("\n--- Public Health Impact ---\n")
cat("Days with high health risk (Ozone > 100 ppb):", high_risk_days, "\n")
cat("Days with moderate health risk (Ozone > 70 ppb):", moderate_risk_days, "\n")
```

**Key Point:** Identified days with dangerously high ozone levels that exceed health safety guidelines

------------------------------------------------------------------------

## Step 5: Detect Solar Radiation Outliers

```{r}
#| echo: true

# Detect outliers in Solar Radiation
solar_outliers <- detect_outliers_iqr(air_clean, "Solar.R")

cat("--- Solar Radiation Outlier Analysis ---\n")
cat("IQR Bounds:", round(solar_outliers$bounds, 2), "Langleys\n")
cat("Number of unusual solar days:", solar_outliers$count, "\n")
cat("Outlier solar radiation values:", sort(round(solar_outliers$values, 2)), "Langleys\n")

# Relationship with ozone
cat("\n--- Solar-Ozone Relationship ---\n")
high_solar_ozone <- mean(air_clean$Ozone[solar_outliers$indices])
cat("Average ozone on high solar days:", round(high_solar_ozone, 2), "ppb\n")
```
**Key Point:** Extreme solar radiation days often correlate with higher ozone levels due to photochemical reactions

------------------------------------------------------------------------

## Step 6: Visualize Environmental Outliers



```{r}
#| echo: true
#| fig-height: 6
#| fig-width: 10

# Create comprehensive environmental visualization
par(mfrow = c(2, 2), mar = c(4, 4, 3, 1))

# Ozone boxplot with health thresholds
boxplot(air_clean$Ozone, main = "Ozone Levels with Health Thresholds", 
        ylab = "Ozone (ppb)", col = "lightblue", las = 1)
points(rep(1, ozone_outliers$count), 
       air_clean$Ozone[ozone_outliers$indices], 
       col = "red", pch = 19, cex = 1.5)
abline(h = 70, col = "orange", lty = 2, lwd = 2)
abline(h = 100, col = "red", lty = 2, lwd = 2)
legend("topright", legend = c("Moderate Risk", "High Risk"), 
       col = c("orange", "red"), lty = 2, lwd = 2)

# Solar radiation boxplot
boxplot(air_clean$Solar.R, main = "Solar Radiation Outliers", 
        ylab = "Solar Radiation (Langleys)", col = "lightgreen", las = 1)
points(rep(1, solar_outliers$count), 
       air_clean$Solar.R[solar_outliers$indices], 
       col = "red", pch = 19, cex = 1.5)

# Wind speed outliers
wind_outliers <- detect_outliers_iqr(air_clean, "Wind")
boxplot(air_clean$Wind, main = "Wind Speed Outliers", 
        ylab = "Wind Speed (mph)", col = "lightcoral", las = 1)
points(rep(1, wind_outliers$count), 
       air_clean$Wind[wind_outliers$indices], 
       col = "red", pch = 19, cex = 1.5)

# Temperature outliers
temp_outliers <- detect_outliers_iqr(air_clean, "Temp")
boxplot(air_clean$Temp, main = "Temperature Outliers", 
        ylab = "Temperature (°F)", col = "lightyellow", las = 1)
points(rep(1, temp_outliers$count), 
       air_clean$Temp[temp_outliers$indices], 
       col = "red", pch = 19, cex = 1.5)
```

**Observation:** Boxplots clearly show environmental outliers with health risk thresholds for immediate interpretation

## Step 7: Time Series Analysis of Pollution Events

```{r}
#| echo: true
#| fig-height: 6
#| fig-width: 10

# Create time series analysis
air_clean$Date <- as.Date(paste("1973", air_clean$Month, air_clean$Day, sep = "-"))

# Plot ozone over time with outliers highlighted
plot(air_clean$Date, air_clean$Ozone, type = "l", 
     main = "Ozone Levels Over Time with Pollution Events",
     xlab = "Date", ylab = "Ozone (ppb)", 
     col = "blue", lwd = 2, las = 1)
points(air_clean$Date[ozone_outliers$indices], 
       air_clean$Ozone[ozone_outliers$indices], 
       col = "red", pch = 19, cex = 1.5)
text(air_clean$Date[ozone_outliers$indices], 
     air_clean$Ozone[ozone_outliers$indices],
     labels = round(air_clean$Ozone[ozone_outliers$indices]), 
     pos = 3, cex = 0.8, col = "red")
abline(h = 70, col = "orange", lty = 2, lwd = 2)
abline(h = 100, col = "red", lty = 2, lwd = 2)
legend("topleft", 
       legend = c("Ozone Level", "Pollution Event", "Moderate Risk", "High Risk"),
       col = c("blue", "red", "orange", "red"), 
       lty = c(1, NA, 2, 2), pch = c(NA, 19, NA, NA),
       lwd = 2)
```
**Environmental Insight:** Time series reveals temporal patterns of pollution events and helps identify seasonal trends

## Step 8: Public Health Risk Assessment

```{r}
#| echo: true
#| fig-height: 6
#| fig-width: 10

# Create public health risk assessment
risk_assessment <- air_clean %>%
  mutate(
    Risk_Level = case_when(
      Ozone > 100 ~ "High Risk",
      Ozone > 70 ~ "Moderate Risk",
      Ozone > 50 ~ "Low Risk",
      TRUE ~ "Good"
    ),
    Is_Outlier = ifelse(row_number() %in% ozone_outliers$indices, "Yes", "No")
  )

# Plot risk assessment
risk_colors <- c("Good" = "green", "Low Risk" = "yellow", 
                "Moderate Risk" = "orange", "High Risk" = "red")

plot(air_clean$Date, air_clean$Ozone, type = "l",
     main = "Public Health Risk Assessment - Ozone Pollution",
     xlab = "Date", ylab = "Ozone (ppb)", 
     col = "gray", lwd = 1, las = 1, ylim = c(0, 170))

# Add colored points based on risk level
points(air_clean$Date, air_clean$Ozone, 
       col = risk_colors[risk_assessment$Risk_Level], 
       pch = 19, cex = 1.2)

# Highlight outliers
points(air_clean$Date[ozone_outliers$indices], 
       air_clean$Ozone[ozone_outliers$indices], 
       col = "black", pch = 1, cex = 2, lwd = 2)

# Add thresholds and legend
abline(h = c(50, 70, 100), col = c("yellow", "orange", "red"), 
       lty = 2, lwd = 2)
legend("topleft",
       legend = c("Good", "Low Risk", "Moderate Risk", "High Risk", "Outlier Day"),
       col = c("green", "yellow", "orange", "red", "black"),
       pch = c(19, 19, 19, 19, 1), pt.cex = c(1, 1, 1, 1, 1.5),
       pt.lwd = c(1, 1, 1, 1, 2))
```
**Application:** Real-time environmental monitoring system that automatically flags days requiring public health advisories.





------------------------------------------------------------------------

## Business Applications

1. **Public Health Monitoring**  
   Automated alert systems for high pollution days to protect vulnerable populations.

2. **Sales Forecasting**  
   Use regression to predict future sales using variables like marketing spend, pricing, or seasonality.

3. **Customer Churn Prediction**  
   Identify which customer behaviors or attributes most strongly indicate churn risk.

4. **Environmental Regulation**  
   Identify industrial compliance issues and unusual emission patterns for regulatory enforcement.
   
5. **Urban Planning**  
   Use outlier patterns to inform traffic management and industrial zoning decisions.

6. **Climate Research**  
   Detect unusual weather patterns and long-term climate change indicators.
------------------------------------------------------------------------



## Exercise : Analyze Your Local Environment

```{r}
# Simulate local temperature data
#| echo: true

# Create sample environmental data with proper row alignment
set.seed(123)
n_days <- 100
sample_data <- data.frame(
  Day = 1:n_days,
  Pollution = c(rnorm(n_days - 5, mean = 50, sd = 15), 
                c(120, 130, 25, 15, 140))  # Pollution spikes
)

# Detect outliers
pollution_outliers <- detect_outliers_iqr(sample_data, "Pollution")
cat("Pollution outliers detected:", pollution_outliers$count, "\n")
cat("Outlier values:", pollution_outliers$values, "\n")
```
**Goal:** Real-time environmental monitoring system that automatically flags days requiring public health advisories.

------------------------------------------------------------------------

## Conclusion

-   **Outlier Detection**: is crucial for environmental monitoring and public health protection.
-   **IQR Method**: provides robust identification of extreme environmental conditions.
-   **Contextual Thresholds**: transform statistical outliers into actionable environmental insights.
-   **Time Series Analysis**: reveals patterns in pollution events and weather extremes.
-   **Automated Monitoring**: enables real-time public health alerts and regulatory responses.

------------------------------------------------------------------------

## Thank You! {.center}

**Questions?**
